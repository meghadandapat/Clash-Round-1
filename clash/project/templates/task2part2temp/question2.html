{% load static %}

<html lang="en">

<head>
    <title>Get it Assured</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <!-- jQuery and JS bundle w/ Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <script src="//cdn.jsdelivr.net/npm/simple-crypto-js@2.5.0/dist/SimpleCrypto.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/css/style.css' %}">
</head>
<script type="text/javascript">
        window.history.forward();
        function noBack()
        {
            window.history.forward();
        }
</script>
<body onLoad="noBack();" onpageshow="if (event.persisted) noBack();" onUnload="" style="height:100vh;background-image: #B69D74;background-image: radial-gradient(circle, #ede7dd 0%, #c4b08f 70%, #B69D74 100%)">

    <nav class="navbar navbar-expand-lg navbar-light" style="background-color:#1f2839;">
        <a class="navbar" href="#"><img src="{% static '/images/clashwhite.png' %}" style="width:80px; height: 40px;"></a>


        <span class="clock" id="time" style="margin-left:20px; color:white;"></span>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse justify justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item fromLeft active">
                    <a class="nav-link active" style="color: white; cursor:pointer;" data-target="#instructionBackdrop" data-toggle="modal">Instructions<span
                            class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link  nav-right" data-target="#staticBackdrop" data-toggle="modal" href="#" id="logoutcall"
                        style="color:white">Log out</a>
                </li>
                <li class="nav-item">
                    <img src="{% static '/images/logo pisb_2.png' %}" style="width:115px ;height:40px ;">
                </li>
            </ul>
        </div>

        <div class="modal fade" id="staticBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">Log out</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        Do you really want to Log out?
                    </div>
                    <div class="modal-footer">
                        <a href="{%url 'logout'%}"><button type="button" class="btn btn-light mybtn" id="log_button">Yes</button></a>
                        <button type="button" class="btn btn-light mybtn" data-dismiss="modal" id="no-button">No</button>
                        <form action="{%url 'visionise'%}" method="post">
                        {% csrf_token %}
                        <button type="submit" name='submit' id="visionise_button" class="btn mybtn btn-light">
                            Visionise
                        </button>
                    </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="instructionBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1"
         aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="instructionBackdropLabel">Instructions for Get it Assured</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <ul style="text-align: left;">
                        <li>The marking scheme for both the attempts are mentioned on the screen.</li>

                        <li>The options are shown in the boxes on the right side of the question box.</li>

                        <li>From the dropdown menu, you can select one of the options and attempt the question.</li>

                        <li>You can answer the question in two attempts. If your first attempt is incorrect, then you will get a second chance. Otherwise
                            you will be redirected to the next question and lifeline will disbursed.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    </nav>

    <div class="spacing"></div>

    <div class="container-fluid centered-layout">
        <div class="row mt-2 myrow">
            <div class="col-12 col-md-2 mt-3 d-flex flex-column">
                <div class="card-header text-center" style="background-color: #f5f5ef; font-weight:bolder;">
                   Marking Scheme (Attempt 1)
                  </div>
                <div class="card text-center" style="background-color:#1f2839;" >
                    <div class="card-body" style="color:white;">
                      <h3 class="card-title">+10 | -8</h3>
                    </div>
                </div>

                  <div class="card-header text-center" style="background-color: #f5f5ef;font-weight:bolder;margin-top:1.2em">
                    Marking Scheme (Attempt 2)
                   </div>
                <div class="card text-center" style="background-color:#1f2839;" >
                     <div class="card-body" style="color:white;">
                       <h3 class="card-title">+8 | -10</h3>
                     </div>
                </div>


                    <div class="card-header text-center" style="background-color: #f5f5ef;font-weight:bolder;margin-top:1.2em">
                    Your Score
                    </div>
                <div class="card text-center" style="background-color:#1f2839;" >
                     <div class="card-body" style="color:white;">
                       <h3 class="card-title">{{user.total_score}}</h3>
                     </div>
                </div>


            </div>
            <div class="col-md-8 mt-3">
                <div class="row">
                    <div class="card mycard" style="height: 42vh;width:100%;background-color: #1f2839; margin:auto">
                        <div class="card-body" style="color:white; font-family:sans-serif;padding:0">
                            <textarea readonly>{{question.question}}</textarea>
                        </div>
                    </div>
                </div>
                <form action="{% url 'success' %}" method="post">
                    {%csrf_token%}
                <div class="d-flex justify-content-around align-items-center dropdown " style="margin-top:40px; height:100px;">

                    <div class="dropdown" id="dropdown1">
                        <div class="card-header text-center" style="background-color: #f5f5ef; font-weight:bolder;">
                            Attempt 1
                           </div>
                        <div class="card text-center" style="background-color:#1f2839;" >
                            
                                <div class="box">
                                    <select id="attempt1" name="attempt1">
                                      <option value="{{question.option_A}}">Option A</option>
                                      <option value="{{question.option_B}}">Option B</option>
                                      <option value="{{question.option_C}}">Option C</option>
                                      <option value="{{question.option_D}}">Option D</option>
                                    </select>
                                </div>
                        </div>
                    </div>


                    <div class="dropdown" id="dropdown2">
                    <div class="card-header text-center" style="background-color: #f5f5ef;font-weight:bolder;margin-top:1.2em">
                      Attempt 2
                     </div>
                   <div class="card text-center" style="background-color:#1f2839;" >
                      <div class="box">
                          <select id="attempt2" name="attempt2">
                              <option value="{{question.option_A}}">Option A</option>
                              <option value="{{question.option_B}}">Option B</option>
                              <option value="{{question.option_C}}">Option C</option>
                              <option value="{{question.option_D}}">Option D</option>
                          </select>
                        </div>
                     </div>
                  </div>
                </div>

                <div class="row mt-2"> <button type="submit" name = 'submit' value={{question.id}} class="btn mybtn btn-light"
                    style="margin:auto; font-weight:bolder">Submit</button></div>
                </form>
            </div>

            
            <div class="col-md-2 mt-3 d-flex flex-column ">
               
                <textarea class="attemptoptions" readonly>A) {{question.option_A}}</textarea>
                <textarea class="attemptoptions" readonly>B) {{question.option_B}}</textarea>
                <textarea class="attemptoptions" readonly>C) {{question.option_C}}</textarea>
                <textarea class="attemptoptions" readonly>D) {{question.option_D}}</textarea>

            </div>

        </div>
    </div>

        <footer class="text-center fixed-bottom " style="background-color:#1f2839; z-index: -1;">
            <div class="container-fluid">
                <div class="footer-text pt-2 pb-3 text-white" style="font-size: 1.25em; font-family:'Segoe UI'">&#169PICT IEEE Student Branch</div>

            </div>
            </footer>


        <script>
            var freeze=0;
            function startTimer(duration, display) {
                var timer = {{time_rem}}, minutes, seconds;
                let newtimer=setInterval(function () {
                    minutes = parseInt(timer / 60, 10);
                    seconds = parseInt(timer % 60, 10);

                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;
                    if (freeze==0){
                    display.textContent = minutes + ":" + seconds;}



                    if (--timer < 0) {
                        timer = duration;
                        if({{user.predicted_score}}>=total_score+5 || {{user.predicted_score}}<=total_score-5){
                            logoutbutton=document.getElementById("logoutcall");
                            logoutbutton.onclick=occur_Click3();
                        }
                        press_button=document.getElementById("log_button");
                        press_button.onclick=occur_Click2();
                        clearTimeout(newtimer);
                        nobutton=document.getElementById("no-button");
                        nobutton.disabled=true;
                    }
                }, 1000);
            }

            window.onload = function () {
                var fiveMinutes = {{time_rem}},
                    display = document.querySelector('#time');
                startTimer(fiveMinutes, display);
            };
        </script>
        <script>
        dropdown11=document.getElementById("attempt1");
        dropdown22=document.getElementById("attempt2")
        if({{user.get_chance}}==1)
        {
            dropdown22.disabled=true;
        }
        if({{user.get_chance}}>=2)
        {
            dropdown11.disabled=true;
        }
        </script>
    <script>
        $('#visionise_button').prop("disabled", true);
            function vision_button(){
                if({{user.predicted_score}}<={{user.total_score}}+5 && {{user.predicted_score}}>={{user.total_score}}-5 && {{user.predicted_score}}!=0){
                    $('#visionise_button').prop("disabled", false);
                }
            }
            vision_button();
    </script>

<script>


    var freeze=0;
    function startTimer(duration, display) {
        var timer = {{time_rem}}, minutes, seconds;
        setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);
    
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
            if (freeze==0){
            display.textContent = minutes + ":" + seconds;}
        
            
    let total_score={{user.total_score}}
            if (--timer < 0) {
            timer = duration;
            if({{user.predicted_score}}>=total_score+5 || {{user.predicted_score}}<=total_score-5){
                    logoutbutton=document.getElementById("logoutcall");
                    logoutbutton.onclick=occur_Click3();
            }
            press_button=document.getElementById("log_button");
            press_button.onclick=occur_Click2();
            nobutton=document.getElementById("no-button");
             nobutton.disabled=true;
            clearTimeout(newtimer);
        }
        }, 1000);
    }
    
    window.onload = function () {
        var fiveMinutes = {{time_rem}},
            display = document.querySelector('#time');
        startTimer(fiveMinutes, display);
    };
      </script>
    <script>
function occur_Click2(){
    document.getElementById("log_button").click();
}
function occur_Click3(){
    document.getElementById("logoutcall").click();
}
</script>
<script>
      $(window).blur(function () {
        console.log("blur got active");
        $.ajax({
          method: "GET",
          headers: { "X-CSRFToken": token },
          url: `${window.location.origin}/handletab/`,
          dataType: "json",
          data: {},
          success: function (data) {
            alert(
              `You have shifted the tab << Turn Remaining - ${data.checktab} >>`
            );
            if (data.checktab <= 0) {
              logoutbutton = document.getElementById("logoutcall");
              logoutbutton.onclick = occur_Click3();
            }
          },
        });
      });
    </script>
</body>

</html>
